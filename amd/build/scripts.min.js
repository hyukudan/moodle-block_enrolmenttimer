/**
 * Live countdown timer for the enrolment timer block.
 *
 * Uses stable data-unit attributes (language-independent) and wall-clock
 * timing to avoid drift from setInterval inaccuracies and tab throttling.
 *
 * @module     block_enrolmenttimer/scripts
 * @copyright  2014 onwards LearningWorks Ltd {@link https://learningworks.co.nz/}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author     Aaron Leggett
 */
define("block_enrolmenttimer/scripts",["jquery"],(function($){return{initialise:function(){$(document).ready((function(){var activeUnits=[],forceTwoDigits=!1,intervalId=null,endTime=0,unitSeconds={years:31536e3,months:2592e3,weeks:604800,days:86400,hours:3600,minutes:60,seconds:1};function updateMainCounter(unitKey,time){var html="",timeStr=time.toString();if(!0===forceTwoDigits&&1===timeStr.length)html+='<span class="timerNumChar" data-id="0">0</span>',html+='<span class="timerNumChar" data-id="1">'+timeStr+"</span>";else for(var i=0;i<timeStr.length;i++)html+='<span class="timerNumChar" data-id="'+i+'">'+timeStr.charAt(i)+"</span>";$('.block_enrolmenttimer .active .timer-wrapper .timerNum[data-unit="'+unitKey+'"]').html(html),$('.block_enrolmenttimer .active .text-desc [data-unit="'+unitKey+'"]').html(time)}function updateLiveCounter(){var remaining=Math.max(0,Math.floor((endTime-Date.now())/1e3));if(remaining<=0){null!==intervalId&&(window.clearInterval(intervalId),intervalId=null);for(var j=0;j<activeUnits.length;j++)updateMainCounter(activeUnits[j],0)}else for(var time=remaining,tokens=["years","months","weeks","days","hours","minutes","seconds"],units=[31536e3,2592e3,604800,86400,3600,60,1],i=0;i<tokens.length;i++)if(-1!==activeUnits.indexOf(tokens[i])){var count=Math.floor(time/units[i]);updateMainCounter(tokens[i],count),time-=count*units[i]}}if($(".block_enrolmenttimer .active").length>0){$(".block_enrolmenttimer .timer-wrapper[data-id=force2]").length>0&&(forceTwoDigits=!0),$(".block_enrolmenttimer .active .timer-wrapper").find(".timerNum[data-unit]").each((function(){activeUnits.push($(this).attr("data-unit"))}));var initialSeconds=function(){for(var timestamp=0,i=0;i<activeUnits.length;i++){var unitKey=activeUnits[i],val=parseInt($('.block_enrolmenttimer .active .text-desc [data-unit="'+unitKey+'"]').text(),10);!isNaN(val)&&unitSeconds[unitKey]&&(timestamp+=val*unitSeconds[unitKey])}return timestamp}();endTime=Date.now()+1e3*initialSeconds,intervalId=window.setInterval((function(){updateLiveCounter()}),1e3),"function"==typeof document.addEventListener&&document.addEventListener("visibilitychange",(function(){!document.hidden&&null===intervalId&&endTime>Date.now()&&(intervalId=window.setInterval((function(){updateLiveCounter()}),1e3),updateLiveCounter())}))}}))}}}));

//# sourceMappingURL=scripts.min.js.map